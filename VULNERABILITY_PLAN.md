# Notebooks-v1 Vulnerability Remediation Plan

## Goals

- Upgrade all base language toolchains to supported and secure versions:
  - **Go 1.24**
  - **Python 3.12**
  - **Node.js 24**
- Resolve all ERROR-level and WARNING-level vulnerability findings across source and built images (WARN-level needs community discussion).
- Manually handle likely-breaking dependency upgrades (assigned per component).

## Scope

- **Go controllers**: `notebooks/components/notebook-controller`, `pvcviewer-controller`, `tensorboard-controller`
- **Python backends**: `crud-web-apps/*/backend`, `example-notebook-servers/*/requirements.txt`
- **Frontend (Node)**: `crud-web-apps/*/frontend`, `common/frontend/kubeflow-common-lib`

---

## Approach

### 1. Language and Toolchain Upgrades ([details](./LANGUAGE_TOOLCHAIN_UPGRADE_PLAN.md))
Upgrade the underlying Go, Python, and Node.js versions early in the process to minimize friction in dependency updates.

| Language | Target Version |
|-----------|----------------|
| Go | 1.24 |
| Python | 3.12 |
| Node.js | 24 |

These upgrades should be landed as early PRs to ensure all subsequent builds align.

---

### 2. Manual PRs for Likely-Breaking Updates
Some dependencies require major upgrades or API changes. These should be handled manually and tested thoroughly.

**Go Controllers:**
- `golang.org/x/oauth2` â†’ `>=0.27.0`
- `golang.org/x/crypto` â†’ `>=0.35.0`
- `golang.org/x/net` â†’ `>=0.38.0`
- `gopkg.in/yaml.v3` â†’ `>=3.0.1`
- `google.golang.org/protobuf` â†’ `>=1.33.0`

**Python CRUD Backends:**
- `Flask` â†’ `>=2.3.2`
- `Werkzeug` â†’ `>=3.0.6`
- Adjust imports and request/response handling as needed.

**Frontend:**
- Start with `overrides` for subdependencies.
- If unresolved, bump:
  - `jsonpath-plus` â†’ `10.x`
  - `form-data` â†’ `4.x`
  - `tough-cookie` â†’ `4.x`
  - `@babel/helpers` â†’ `7.26.10+`
  - `webpack` â†’ `5.94.0+`
  - `cross-spawn` â†’ `7.0.5+`

**Notebook Images:**
- Upgrade `jupyterlab-git` â†’ `0.51.1` in all relevant `requirements.txt` files.

#### PR Slicing

- One PR per component per language area (e.g., Go & `components/notebook-controller` packages: `google.golang.org/protobuf`, `gopkg.in/yaml.v3`, `golang.org/x/oauth2`, `golang.org/x/net`, `golang.org/x/crypto`, `google.golang.org/protobuf`).

---

### 3. Optional: Safe Minor Version Automation (Nice-to-Have)
At a later phase, we can introduce a lightweight automation for safe, minor dependency updates.

- **`tools/security/cves.yaml`**
        * Purpose: A central configuration file that acts as a "fix list," telling the update script exactly which version to update to.
        * Benefit: Provides precise control. The script only updates packages you list, to the *exact minimum version* required, rather than blindly updating everything.
- **`tools/security/dep-safe-update.sh`**
        * Purpose: The script that performs the actual work, using `cves.yaml` as its instruction manual.
        * Actions by Language:
            * Go: Reads target versions from `cves.yaml` and runs `go get pkg@version`. Follows with `go mod tidy` and verifies with `go build ./...`.
            * Python: Bumps package versions in `requirements.txt` (e.g., `requests>=2.32.4`) and runs `pip-audit` to confirm the fix.
            * Node: Uses `npm update` for safe patches. Can also use `overrides`/`resolutions` in `package.json` to force a vulnerable sub-dependency to a safe version without breaking the parent package.

- Useful for routine maintenance once the main dependency cleanup is complete.
- Should only trigger on explicitly listed packages, not all dependencies.
- need to handle edge cases as:
    - if it was only released < 24 hours ago - that seems scary?
    - are there bug reports for the recent version that was make us want to choose a slightly older (but still newer) dependency


---

## CI & Release Flow

- Existing Docker workflows continue to publish images automatically.
- Manual PRs and upgrades must pass build and test workflows.

---

## Acceptance Criteria

- All components build successfully with the upgraded language versions.
- No **ERROR-level** and **WARN-level** vulnerabilities in source or images.
- Manual dependency PRs merged and validated.

---

## Risks & Mitigations

| Risk | Mitigation |
|------|-------------|
| Breaking dependency APIs (e.g., Flask or Go modules) | Split into focused, well-tested PRs per component and validate builds before merging. |
| Language version incompatibility (e.g., new deps requiring newer Go/Python/Node) | Land Go 1.24 / Python 3.12 / Node 24 early to ensure compatibility across modules. |
| Frontend dependency conflicts | Rely on npmâ€™s built-in dependency resolution and lockfile updates; avoid manual overrides. |

---

## Affected Files (from current (2.11) findings)

- Go:
  - `components/notebook-controller/go.mod`
  - `components/pvcviewer-controller/go.mod`
  - `components/tensorboard-controller/go.mod`
- Python:
  - CRUD backends: `components/crud-web-apps/common/backend/kubeflow/kubeflow/crud_backend/requirements.txt`
  - CRUD backends: `components/crud-web-apps/{jupyter,tensorboards,volumes}/backend/requirements.txt`
  - Images: `components/example-notebook-servers/*/requirements.txt`
- Frontend (Node):
  - `components/crud-web-apps/{jupyter,tensorboards,volumes}/frontend/package.json`
  - `components/crud-web-apps/common/frontend/kubeflow-common-lib/package.json`
  - `components/crud-web-apps/common/frontend/kubeflow-common-lib/projects/kubeflow/package.json`

## List of packages

### 1. Go Components

#### `components/notebook-controller`

**ðŸš€ Major Changes (Likely-Breaking)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `golang.org/x/crypto` | `go.mod` | `v0.0.0-2021...` | `v0.35.0` |
| `golang.org/x/net` | `go.mod` | `v0.0.0-2021...` | `v0.38.0` |
| `golang.org/x/oauth2` | `go.mod` | `v0.0.0-2021...` | `v0.27.0` |
| `gopkg.in/yaml.v3` | `go.mod` | `v3.0.0` | `v3.0.1` |
| `google.golang.org/protobuf` | `go.mod` | `v1.27.1` | `v1.33.0` |

**ðŸ›¡ï¸ Minor Changes (Safe Updates)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `golang.org/x/sys` | `go.mod` | `v0.0.0-2021...` | `v0.0.0-2022...` |
| `golang.org/x/text` | `go.mod` | `v0.3.7` | `v0.3.8` |

#### `components/pvcviewer-controller`

**ðŸš€ Major Changes (Likely-Breaking)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `golang.org/x/net` | `go.mod` | `v0.24.0` | `v0.38.0` |
| `golang.org/x/oauth2` | `go.mod` | `v0.19.0` | `v0.27.0` |

#### `components/tensorboard-controller`

**ðŸš€ Major Changes (Likely-Breaking)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `golang.org/x/crypto` | `go.mod` | `v0.14.0` | `v0.35.0` |
| `golang.org/x/net` | `go.mod` | `v0.17.0` | `v0.38.0` |
| `golang.org/x/oauth2` | `go.mod` | `v0.0.0-2021...` | `v0.27.0` |
| `gopkg.in/yaml.v3` | `go.mod` | `v3.0.0-2021...` | `v3.0.1` |
| `google.golang.org/protobuf` | `go.mod` | `v1.27.1` | `v1.33.0` |

---
### 2. Python Components

#### `.../crud-web-apps/common/backend/.../crud_backend`

**ðŸš€ Major Changes (Likely-Breaking)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `Flask` | `requirements.txt` | `1.1.1` | `v2.3.2` |
| `Werkzeug` | `requirements.txt` | `0.16.0` | `v3.0.6` |

**ðŸ›¡ï¸ Minor Changes (Safe Updates)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `requests` | `requirements.txt` | `2.22.0` | `v2.32.4` |
| `urllib3` | `requirements.txt` | `1.26.18` | `v2.5.0` |

#### `components/example-notebook-servers/*`

**ðŸš€ Major Changes (Likely-Breaking)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `jupyterlab-git` | `requirements.txt` (in 6 subdirs) | `0.50.2` | `0.51.1` |

---
### 3. Node.js Components

#### `.../crud-web-apps/common/frontend/kubeflow-common-lib`

**ðŸš€ Major Changes (Likely-Breaking)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `@babel/helpers` | `package-lock.json` | `7.26.0` | `v7.26.10` |

#### `.../crud-web-apps/jupyter/frontend`

**ðŸš€ Major Changes (Likely-Breaking)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `@babel/helpers` | `package-lock.json` | `7.26.0` | `v7.26.10` |
| `cross-spawn` | `package-lock.json` | `7.0.3` | `v7.0.5` |
| `form-data` | `package-lock.json` | `2.3.3 / 2.5.2` | `v4.0.4` |
| `jsonpath-plus` | `package-lock.json` | `0.19.0` | `v10.3.0` |
| `tough-cookie` | `package-lock.json` | `2.5.0` | `v4.1.3` |

#### `.../crud-web-apps/tensorboards/frontend`

**ðŸš€ Major Changes (Likely-Breaking)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `@babel/helpers` | `package-lock.json` | `7.26.0` | `v7.26.10` |
| `form-data` | `package-lock.json` | `2.3.3 / 2.5.2` | `v4.0.4` |
| `jsonpath-plus` | `package-lock.json` | `0.19.0` | `v10.3.0` |
| `tough-cookie` | `package-lock.json` | `2.5.0` | `v4.1.3` |

#### `.../crud-web-apps/volumes/frontend`

**ðŸš€ Major Changes (Likely-Breaking)**
| Pkg Name | File Path | From (Installed) | To (Target) |
| :--- | :--- | :--- | :--- |
| `@babel/helpers` | `package-lock.json` | `7.25.0` | `v7.26.10` |
| `cross-spawn` | `package-lock.json` | `7.0.3` | `v7.0.5` |
| `form-data` | `package-lock.json` | `2.3.3 / 2.5.1` | `v4.0.4` |
| `jsonpath-plus` | `package-lock.json` | `0.19.0` | `v10.3.0` |
| `tough-cookie` | `package-lock.json` | `2.5.0` | `v4.1.3` |
| `webpack` | `package-lock.json` | `5.93.0` | `v5.94.0` |

---

## To-dos

- [ ] Upgrade Go to **1.24**
- [ ] Upgrade Python to **3.12**
- [ ] Upgrade Node.js to **24**
- [ ] Manually update Go, Python, and Node dependencies per component
- [ ] Verify builds and tests after upgrades
- [ ] (Optional) Add safe minor automation as a follow-up improvement
