# Notebooks-v1 Vulnerability Remediation Plan

## Goals

- Upgrade all base language toolchains to supported and secure versions:
  - **Go 1.24**
  - **Python 3.12**
  - **Node.js 24**
- Resolve all ERROR-level and WARNING-level vulnerability findings across source and built images (WARN-level needs community discussion).
- Manually handle likely-breaking dependency upgrades (assigned per component).

## Scope

- **Go controllers**: `notebooks/components/notebook-controller`, `pvcviewer-controller`, `tensorboard-controller`
- **Python backends**: `crud-web-apps/*/backend`, `example-notebook-servers/*/requirements.txt`
- **Frontend (Node)**: `crud-web-apps/*/frontend`, `common/frontend/kubeflow-common-lib`

---

## Approach

### 1. Language and Toolchain Upgrades ([details](./LANGUAGE_TOOLCHAIN_UPGRADE_PLAN.md))
Upgrade the underlying Go, Python, and Node.js versions early in the process to minimize friction in dependency updates.

| Language | Target Version |
|-----------|----------------|
| Go | 1.24 |
| Python | 3.12 |
| Node.js | 24 |

These upgrades should be landed as early PRs to ensure all subsequent builds align.

---

### 2. Manual PRs for Likely-Breaking Updates
Some dependencies require major upgrades or API changes. These should be handled manually and tested thoroughly.

**Go Controllers:**
- `golang.org/x/oauth2` → `>=0.27.0`
- `golang.org/x/crypto` → `>=0.35.0`
- `golang.org/x/net` → `>=0.38.0`
- `gopkg.in/yaml.v3` → `>=3.0.1`
- `google.golang.org/protobuf` → `>=1.33.0`

**Python CRUD Backends:**
- `Flask` → `>=2.3.2`
- `Werkzeug` → `>=3.0.6`
- Adjust imports and request/response handling as needed.

**Frontend:**
- Start with `overrides` for subdependencies.
- If unresolved, bump:
  - `jsonpath-plus` → `10.x`
  - `form-data` → `4.x`
  - `tough-cookie` → `4.x`
  - `@babel/helpers` → `7.26.10+`
  - `webpack` → `5.94.0+`
  - `cross-spawn` → `7.0.5+`

**Notebook Images:**
- Upgrade `jupyterlab-git` → `0.51.1` in all relevant `requirements.txt` files.

#### PR Slicing

- One PR per component per language area (e.g., Go & `components/notebook-controller` packages: `google.golang.org/protobuf`, `gopkg.in/yaml.v3`, `golang.org/x/oauth2`, `golang.org/x/net`, `golang.org/x/crypto`, `google.golang.org/protobuf`).

---

### 3. Optional: Safe Minor Version Automation (Nice-to-Have)
At a later phase, we can introduce a lightweight automation for safe, minor dependency updates.

- **`tools/security/cves.yaml`**
        * Purpose: A central configuration file that acts as a "fix list," telling the update script exactly which version to update to.
        * Benefit: Provides precise control. The script only updates packages you list, to the *exact minimum version* required, rather than blindly updating everything.
- **`tools/security/dep-safe-update.sh`**
        * Purpose: The script that performs the actual work, using `cves.yaml` as its instruction manual.
        * Actions by Language:
            * Go: Reads target versions from `cves.yaml` and runs `go get pkg@version`. Follows with `go mod tidy` and verifies with `go build ./...`.
            * Python: Bumps package versions in `requirements.txt` (e.g., `requests>=2.32.4`) and runs `pip-audit` to confirm the fix.
            * Node: Uses `npm update` for safe patches. Can also use `overrides`/`resolutions` in `package.json` to force a vulnerable sub-dependency to a safe version without breaking the parent package.

- Useful for routine maintenance once the main dependency cleanup is complete.
- Should only trigger on explicitly listed packages, not all dependencies.
- need to handle edge cases as:
    - if it was only released < 24 hours ago - that seems scary?
    - are there bug reports for the recent version that was make us want to choose a slightly older (but still newer) dependency


---

## CI & Release Flow

- Existing Docker workflows continue to publish images automatically.
- Manual PRs and upgrades must pass build and test workflows.

---

## Acceptance Criteria

- All components build successfully with the upgraded language versions.
- No **ERROR-level** and **WARN-level** vulnerabilities in source or images.
- Manual dependency PRs merged and validated.

---

## Risks & Mitigations

| Risk | Mitigation |
|------|-------------|
| Breaking dependency APIs (e.g., Flask or Go modules) | Split into focused, well-tested PRs per component and validate builds before merging. |
| Language version incompatibility (e.g., new deps requiring newer Go/Python/Node) | Land Go 1.24 / Python 3.12 / Node 24 early to ensure compatibility across modules. |
| Frontend dependency conflicts | Rely on npm’s built-in dependency resolution and lockfile updates; avoid manual overrides. |

---

## Affected Files (from current (2.11) findings)

- Go:
  - `components/notebook-controller/go.mod`
  - `components/pvcviewer-controller/go.mod`
  - `components/tensorboard-controller/go.mod`
- Python:
  - CRUD backends: `components/crud-web-apps/common/backend/kubeflow/kubeflow/crud_backend/requirements.txt`
  - CRUD backends: `components/crud-web-apps/{jupyter,tensorboards,volumes}/backend/requirements.txt`
  - Images: `components/example-notebook-servers/*/requirements.txt`
- Frontend (Node):
  - `components/crud-web-apps/{jupyter,tensorboards,volumes}/frontend/package.json`
  - `components/crud-web-apps/common/frontend/kubeflow-common-lib/package.json`
  - `components/crud-web-apps/common/frontend/kubeflow-common-lib/projects/kubeflow/package.json`

### List of Packages

| Component | Path | Package | Current Version(s) | Severity | CVE ID(s) | Final Fixed Version |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **CRUD Web Apps** | `components/crud-web-apps/common/frontend/kubeflow-common-lib/package-lock.json`<br>`components/crud-web-apps/jupyter/frontend/package-lock.json`<br>`components/crud-web-apps/tensorboards/frontend/package-lock.json`<br>`components/crud-web-apps/volumes/frontend/package-lock.json` | **@angular/common** | 14.3.0 | **HIGH** | [CVE-2025-66035](https://avd.aquasec.com/nvd/cve-2025-66035) | **21.0.1** |
| **CRUD Web Apps** | `components/crud-web-apps/common/frontend/kubeflow-common-lib/package-lock.json`<br>`components/crud-web-apps/jupyter/frontend/package-lock.json`<br>`components/crud-web-apps/tensorboards/frontend/package-lock.json`<br>`components/crud-web-apps/volumes/frontend/package-lock.json` | **@angular/compiler** | 14.3.0 | **HIGH** | [CVE-2025-66412](https://avd.aquasec.com/nvd/cve-2025-66412) | **21.0.2** |
| **CRUD Web Apps** | `components/crud-web-apps/tensorboards/frontend/package-lock.json` | **@babel/helpers** | 7.26.0 | MEDIUM | [CVE-2025-27789](https://avd.aquasec.com/nvd/cve-2025-27789) | **7.26.10** |
| **CRUD Web Apps** | `components/crud-web-apps/jupyter/frontend/package-lock.json`<br>`components/crud-web-apps/tensorboards/frontend/package-lock.json`<br>`components/crud-web-apps/volumes/frontend/package-lock.json` | **form-data** | 2.3.3<br>2.5.2 | **CRITICAL** | [CVE-2025-7783](https://avd.aquasec.com/nvd/cve-2025-7783) | **4.0.4** |
| **CRUD Web Apps** | `components/crud-web-apps/tensorboards/frontend/package-lock.json` | **js-yaml** | 4.1.0 | MEDIUM | [CVE-2025-64718](https://avd.aquasec.com/nvd/cve-2025-64718) | **4.1.1** |
| **CRUD Web Apps** | `components/crud-web-apps/jupyter/frontend/package-lock.json`<br>`components/crud-web-apps/tensorboards/frontend/package-lock.json`<br>`components/crud-web-apps/volumes/frontend/package-lock.json` | **jsonpath-plus** | 0.19.0 | **CRITICAL** | [CVE-2024-21534](https://avd.aquasec.com/nvd/cve-2024-21534)<br>[CVE-2025-1302](https://avd.aquasec.com/nvd/cve-2025-1302) | **10.3.0** |
| **Example Notebook Servers** | `components/example-notebook-servers/jupyter-pytorch-cuda-full/requirements.txt`<br>`components/example-notebook-servers/jupyter-pytorch-full/requirements.txt`<br>`components/example-notebook-servers/jupyter-pytorch-gaudi-full/requirements.txt`<br>`components/example-notebook-servers/jupyter-scipy/requirements.txt`<br>`components/example-notebook-servers/jupyter-tensorflow-cuda-full/requirements.txt`<br>`components/example-notebook-servers/jupyter-tensorflow-full/requirements.txt` | **jupyterlab-git** | 0.50.2 | **HIGH** | [CVE-2025-30370](https://avd.aquasec.com/nvd/cve-2025-30370) | **0.51.1** |
| **CRUD Web Apps** | `components/crud-web-apps/jupyter/frontend/package-lock.json`<br>`components/crud-web-apps/tensorboards/frontend/package-lock.json`<br>`components/crud-web-apps/volumes/frontend/package-lock.json` | **tough-cookie** | 2.5.0 | MEDIUM | [CVE-2023-26136](https://avd.aquasec.com/nvd/cve-2023-26136) | **4.1.3** |
| **Notebook Controller**<br>**Tensorboard Controller** | `components/notebook-controller/go.mod`<br>`components/tensorboard-controller/go.mod` | **golang.org/x/crypto** | v0.0.0-20210817...<br>v0.14.0 | **CRITICAL** | [CVE-2024-45337](https://avd.aquasec.com/nvd/cve-2024-45337)<br>[CVE-2025-22869](https://avd.aquasec.com/nvd/cve-2025-22869)<br>[CVE-2025-47914](https://avd.aquasec.com/nvd/cve-2025-47914)<br>[CVE-2025-58181](https://avd.aquasec.com/nvd/cve-2025-58181)<br>[CVE-2021-43565](https://avd.aquasec.com/nvd/cve-2021-43565)<br>[CVE-2022-27191](https://avd.aquasec.com/nvd/cve-2022-27191)<br>[CVE-2023-48795](https://avd.aquasec.com/nvd/cve-2023-48795) | **0.45.0** |
| **Notebook Controller**<br>**PVC Viewer Controller**<br>**Tensorboard Controller** | `components/notebook-controller/go.mod`<br>`components/pvcviewer-controller/go.mod`<br>`components/tensorboard-controller/go.mod` | **golang.org/x/net** | v0.0.0-20210825...<br>v0.24.0<br>v0.17.0 | **HIGH** | [CVE-2022-27664](https://avd.aquasec.com/nvd/cve-2022-27664)<br>[CVE-2025-22870](https://avd.aquasec.com/nvd/cve-2025-22870)<br>[CVE-2025-22872](https://avd.aquasec.com/nvd/cve-2025-22872)<br>[CVE-2022-41723](https://avd.aquasec.com/nvd/cve-2022-41723)<br>[CVE-2023-39325](https://avd.aquasec.com/nvd/cve-2023-39325)<br>[CVE-2023-45288](https://avd.aquasec.com/nvd/cve-2023-45288)<br>[CVE-2022-41717](https://avd.aquasec.com/nvd/cve-2022-41717)<br>[CVE-2023-3978](https://avd.aquasec.com/nvd/cve-2023-3978)<br>[CVE-2023-44487](https://avd.aquasec.com/nvd/cve-2023-44487) | **0.38.0** |
| **Notebook Controller**<br>**PVC Viewer Controller**<br>**Tensorboard Controller** | `components/notebook-controller/go.mod`<br>`components/pvcviewer-controller/go.mod`<br>`components/tensorboard-controller/go.mod` | **golang.org/x/oauth2** | v0.0.0-20210819...<br>v0.19.0 | **HIGH** | [CVE-2025-22868](https://avd.aquasec.com/nvd/cve-2025-22868) | **0.27.0** |
| **Notebook Controller** | `components/notebook-controller/go.mod` | **golang.org/x/sys** | v0.0.0-20211029... | MEDIUM | [CVE-2022-29526](https://avd.aquasec.com/nvd/cve-2022-29526) | **Latest** |
| **Notebook Controller** | `components/notebook-controller/go.mod` | **golang.org/x/text** | v0.3.7 | **HIGH** | [CVE-2022-32149](https://avd.aquasec.com/nvd/cve-2022-32149) | **0.3.8** |
| **Notebook Controller**<br>**Tensorboard Controller** | `components/notebook-controller/go.mod`<br>`components/tensorboard-controller/go.mod` | **google.golang.org/protobuf** | v1.27.1 | MEDIUM | [CVE-2024-24786](https://avd.aquasec.com/nvd/cve-2024-24786) | **1.33.0** |
| **Notebook Controller**<br>**Tensorboard Controller** | `components/notebook-controller/go.mod`<br>`components/tensorboard-controller/go.mod` | **gopkg.in/yaml.v3** | v3.0.0<br>v3.0.0-20210107... | **HIGH** | [CVE-2022-28948](https://avd.aquasec.com/nvd/cve-2022-28948) | **3.0.1** |


## To-dos

- [ ] Upgrade Go to **1.24**
- [ ] Upgrade Python to **3.12**
- [ ] Upgrade Node.js to **24**
- [ ] Manually update Go, Python, and Node dependencies per component
- [ ] Verify builds and tests after upgrades
- [ ] (Optional) Add safe minor automation as a follow-up improvement
- [ ] 


